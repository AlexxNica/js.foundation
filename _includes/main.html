{% if include.layout %}
	{% assign suffix = include.layout | prepend: "_" | append: "-layout" %}
{% else %}
	{% assign suffix = "" %}
{% endif %}

<main class="main{{ suffix }}">

	<article class="main-content{{ suffix }}">

		{% if page.split %}
			{% assign split_tag = page.split | prepend: "<" %}
		{% else %}
			{% assign split_tag = "<h2" %}
		{% endif %}

		{% assign sections = content | markdownify | split: split_tag %}

		<header class="page-header{{ suffix }}">

			{% if page.title %}
				<h1 class="page-title{{ suffix }}">{{ page.title }}</h1>
			{% endif %}

			{% if page.submenu %}
				<nav class="page-sub-nav{{ suffix }}">
					<ul class="page-submenu{{ suffix }}">

						{% for item in site.data[ page.submenu ] %}

							{% if item.sub != null %}

								{% if item.href != page.url %}

									<li class="page-submenu-item{{ suffix }}">

										{% if item.href != null %}

											<a class="page-submenu-link{{ suffix }}{% if item.href == page.url %} current{% endif %}" href="{{ site.url }}{{ item.href }}">{{ item.title }}</a>

										{% else %}

											{{ item.title }}

										{% endif %}

										<ul class="page-submenu-submenu{{ suffix }}">

								{% endif %}

											{% for subitem in item.sub %}
												<li class="page-submenu-submenu-item{{ suffix }}">
													<a class="page-submenu-submenu-link{{ suffix }}{% if subitem.subhref == page.url %} current{% endif %}" href="{{ site.url }}{{ subitem.subhref }}">{{ subitem.subtitle }}</a>
												</li>

											{% endfor %}

								{% if item.href != page.url %}

										</ul>
									</li>

								{% endif %}

							{% endif %}

						{% endfor %}

					</ul>
				</nav>
			{% endif %}

			{% if sections.first != '' and sections.size != 1 %}
				<div class="page-intro{{ suffix }}">
					{{ sections.first }}
				</div>
			{% endif %}

		</header>

		<div class="page-sections{{ suffix }}">

			{% for section in sections %}
				{% unless forloop.first and sections.size != 1 %}
					<section class="page-section{{ suffix }}">
						{% if split_tag != "<h2" and section contains "<h2" %}
							{% assign replacement = '</section><section class="page-section' | append: suffix | append: '"><h2' %}
							{% unless sections.size == 1 %}{{ split_tag }}{% endunless %}{{ section | replace: "<h2", replacement }}
						{% else %}
							{% unless sections.size == 1 %}{{ split_tag }}{% endunless %}{{ section }}
						{% endif %}
					</section>
				{% endunless %}
			{% endfor %}

		</div>

	</article>

</main>
